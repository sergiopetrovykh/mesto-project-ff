(()=>{"use strict";function e(e){e.target.classList.contains("popup")&&n(e.target)}function t(t){t&&t.classList.contains("popup")&&(t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")}),10),document.addEventListener("keydown",r),t.addEventListener("click",e))}function n(t){t&&t.classList.contains("popup_is-opened")&&(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r),t.removeEventListener("click",e),t.addEventListener("transitionend",(function(){t.classList.contains("popup_is-opened")||t.classList.remove("popup_is-animated")}),{once:!0}))}function r(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}}var o={baseUrl:"https://nomoreparties.co/v1/wff-cohort-19",headers:{authorization:"87054df0-c254-457a-b792-2fab7c029207","Content-Type":"application/json"}},c=function(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function i(e){var t=e.target,n=t.closest(".card").querySelector(".card__like-counter");t.classList.toggle("card__like-button_is-active");var r=parseInt(n.textContent,10)||0;t.classList.contains("card__like-button_is-active")?r+=1:r-=1,r>0?(n.textContent=r,n.classList.add("card__like-counter_is-active")):(n.textContent="",n.classList.remove("card__like-counter_is-active"))}function a(e,r,o){e.preventDefault();var i=document.querySelector(".popup_type_confirm"),a=i.querySelector(".popup__button_confirm");t(i),a.onclick=function(){c(r).then((function(){o.remove(),n(i)})).catch((function(e){return console.log(e)}))}}function u(e,t,n,r,o){return function(e,t,n,r,o,c){var i=e.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__image"),u=i.querySelector(".card__title"),s=i.querySelector(".card__like-button"),l=i.querySelector(".card__delete-button"),p=i.querySelector(".card__like-counter");return a.src=t.link,a.alt=t.name,u.textContent=t.name,p.textContent=t.likes.length>0?t.likes.length:"",t.likes.length>0&&p.classList.add("card__like-counter_is-active"),a.addEventListener("click",(function(){return n(t)})),s.addEventListener("click",r),t.owner._id===c?l.addEventListener("click",(function(e){return o(e,t._id,i)})):l.style.display="none",i}(document.getElementById("card-template").content,e,t,n,r,o)}function s(e,t){var n=e.closest(t.formSelector).querySelector(".".concat(e.name,"-input-error"));n&&(n.textContent="",n.classList.remove(t.errorClass),e.classList.remove(t.inputErrorClass))}function l(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function p(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(e){return s(e,t)})),r.classList.add(t.inactiveButtonClass),r.disabled=!0}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var f=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),y=m.querySelector(".popup__close"),v=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_new-card"),h=S.querySelector(".popup__close"),b=document.querySelector(".popup_type_image"),L=b.querySelector(".popup__close"),q=m.querySelector(".popup__form"),g=m.querySelector(".popup__input_type_name"),k=m.querySelector(".popup__input_type_description"),E=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),j=document.querySelector(".profile__image"),x=S.querySelector(".popup__form"),A=S.querySelector(".popup__input_type_card-name"),B=S.querySelector(".popup__input_type_url"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},w=function(e){var t=e.buttonElement,n=e.isLoading;t.textContent=n?"Сохранение...":"Сохранить"};function U(e){var n=b.querySelector(".popup__image"),r=b.querySelector(".popup__caption");n.src=e.link,n.alt=e.name,r.textContent=e.name,t(b)}Promise.all([fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t,n,r,o,c,s,l,p,_=(s=2,function(e){if(Array.isArray(e))return e}(c=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,i,a=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return a}}(c,s)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(c,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),m=_[0],y=_[1];n=(t=m).name,r=t.about,o=t.avatar,E.textContent=n,C.textContent=r,j.style.backgroundImage="url(".concat(o,")"),l=y,p=m._id,l.forEach((function(e){return f.appendChild(function(e,t){return u(e,U,i,a,t)}(e,p))}))})).catch((function(e){return console.log(e)})),_.addEventListener("click",(function(){g.value=E.textContent,k.value=C.textContent,t(m),p(q,P)})),y.addEventListener("click",(function(){return n(m)})),q.addEventListener("submit",(function(e){e.preventDefault();var t,r,c=q.querySelector(P.submitButtonSelector);w({buttonElement:c,isLoading:!0}),(t=g.value,r=k.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){E.textContent=e.name,C.textContent=e.about,n(m)})).catch((function(e){return console.log(e)})).finally((function(){w({buttonElement:c,isLoading:!1})}))})),v.addEventListener("click",(function(){t(S),x.reset(),p(x,P)})),h.addEventListener("click",(function(){return n(S)})),x.addEventListener("submit",(function(e){e.preventDefault();var t=x.querySelector(P.submitButtonSelector);w({buttonElement:t,isLoading:!0});var r,c,s={name:A.value,link:B.value};(r=s.name,c=s.link,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:r,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=e.owner._id;f.prepend(u(e,U,i,a,t)),n(S),x.reset(),p(x,P)})).catch((function(e){return console.log(e)})).finally((function(){w({buttonElement:t,isLoading:!1})}))})),L.addEventListener("click",(function(){return n(b)}));var I=document.querySelector(".popup_type_edit-avatar"),O=I.querySelector(".popup__form"),T=I.querySelector(".popup__input_type_url"),D=I.querySelector(".popup__close");document.querySelector(".profile__image").addEventListener("click",(function(){t(I),O.reset(),p(O,P)})),D.addEventListener("click",(function(){return n(I)})),O.addEventListener("submit",(function(e){e.preventDefault();var t,r=O.querySelector(P.submitButtonSelector);w({buttonElement:r,isLoading:!0}),(t=T.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){j.style.backgroundImage="url(".concat(e.avatar,")"),n(I)})).catch((function(e){return console.log(e)})).finally((function(){w({buttonElement:r,isLoading:!1})}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){var n="";e.validity.valueMissing?n="Вы пропустили это поле.":e.validity.tooShort?n="Должно быть от ".concat(e.minLength," до ").concat(e.maxLength," символов."):e.validity.patternMismatch?n=e.dataset.errorMessage||"Неверный формат.":e.validity.typeMismatch&&(n="url"===e.type?"Введите адрес сайта.":"Введите корректное значение."),e.validity.valid?s(e,t):function(e,t,n){var r=e.closest(n.formSelector).querySelector(".".concat(e.name,"-input-error"));r&&(r.textContent=t,r.classList.add(n.errorClass),e.classList.add(n.inputErrorClass))}(e,n,t)}(t,e),l(n,r,e)}))})),t.addEventListener("submit",(function(e){return e.preventDefault()})),l(n,r,e)}))}(P)})();