(()=>{"use strict";function e(e){e.target.classList.contains("popup")&&n(e.target)}function t(t){t&&t.classList.contains("popup")&&(t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")}),10),document.addEventListener("keydown",r),t.addEventListener("click",e))}function n(t){t&&t.classList.contains("popup_is-opened")&&(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r),t.removeEventListener("click",e),t.addEventListener("transitionend",(function(){t.classList.contains("popup_is-opened")||t.classList.remove("popup_is-animated")}),{once:!0}))}function r(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}}var o={baseUrl:"https://nomoreparties.co/v1/wff-cohort-19",headers:{authorization:"87054df0-c254-457a-b792-2fab7c029207","Content-Type":"application/json"}},c=function(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},i=function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},a=function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function u(e){var t=e.target,n=t.closest(".card"),r=n.querySelector(".card__like-counter"),o=n.dataset.cardId;t.classList.contains("card__like-button_is-active")?a(o).then((function(e){t.classList.remove("card__like-button_is-active"),r.textContent=e.likes.length>0?e.likes.length:"",0===e.likes.length&&r.classList.remove("card__like-counter_is-active")})).catch((function(e){return console.log(e)})):i(o).then((function(e){t.classList.add("card__like-button_is-active"),r.textContent=e.likes.length,r.classList.add("card__like-counter_is-active")})).catch((function(e){return console.log(e)}))}function s(e,r,o){e.preventDefault();var i=document.querySelector(".popup_type_confirm"),a=i.querySelector(".popup__button_confirm");t(i),a.onclick=function(){c(r).then((function(){o.remove(),n(i)})).catch((function(e){return console.log(e)}))}}function l(e,t,n,r,o){return function(e,t,n,r,o,c){var i=e.querySelector(".card").cloneNode(!0);i.dataset.cardId=t._id;var a=i.querySelector(".card__image"),u=i.querySelector(".card__title"),s=i.querySelector(".card__like-button"),l=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-counter");return a.src=t.link,a.alt=t.name,u.textContent=t.name,d.textContent=t.likes.length>0?t.likes.length:"",t.likes.length>0&&d.classList.add("card__like-counter_is-active"),t.likes.some((function(e){return e._id===c}))&&s.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){return n(t)})),s.addEventListener("click",r),t.owner._id===c?l.addEventListener("click",(function(e){return o(e,t._id,i)})):l.style.display="none",i}(document.getElementById("card-template").content,e,t,n,r,o)}function d(e,t){var n=e.closest(t.formSelector).querySelector(".".concat(e.name,"-input-error"));n&&(n.textContent="",n.classList.remove(t.errorClass),e.classList.remove(t.inputErrorClass))}function p(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function f(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(e){return d(e,t)})),r.classList.add(t.inactiveButtonClass),r.disabled=!0}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),h=v.querySelector(".popup__close"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_new-card"),L=b.querySelector(".popup__close"),k=document.querySelector(".popup_type_image"),g=k.querySelector(".popup__close"),q=v.querySelector(".popup__form"),E=v.querySelector(".popup__input_type_name"),C=v.querySelector(".popup__input_type_description"),j=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),A=document.querySelector(".profile__image"),P=b.querySelector(".popup__form"),B=b.querySelector(".popup__input_type_card-name"),U=b.querySelector(".popup__input_type_url"),w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},T=function(e){var t=e.buttonElement,n=e.isLoading;t.textContent=n?"Сохранение...":"Сохранить"};function I(e){var n=k.querySelector(".popup__image"),r=k.querySelector(".popup__caption");n.src=e.link,n.alt=e.name,r.textContent=e.name,t(k)}Promise.all([fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t,n,r,o,c,i,a,d,p=(i=2,function(e){if(Array.isArray(e))return e}(c=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,i,a=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return a}}(c,i)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(c,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=p[0],y=p[1];n=(t=f).name,r=t.about,o=t.avatar,j.textContent=n,x.textContent=r,A.style.backgroundImage="url(".concat(o,")"),a=y,d=f._id,a.forEach((function(e){return m.appendChild(function(e,t){return l(e,I,u,s,t)}(e,d))}))})).catch((function(e){return console.log(e)})),y.addEventListener("click",(function(){E.value=j.textContent,C.value=x.textContent,t(v),f(q,w)})),h.addEventListener("click",(function(){return n(v)})),q.addEventListener("submit",(function(e){e.preventDefault();var t,r,c=q.querySelector(w.submitButtonSelector);T({buttonElement:c,isLoading:!0}),(t=E.value,r=C.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){j.textContent=e.name,x.textContent=e.about,n(v)})).catch((function(e){return console.log(e)})).finally((function(){T({buttonElement:c,isLoading:!1})}))})),S.addEventListener("click",(function(){t(b),P.reset(),f(P,w)})),L.addEventListener("click",(function(){return n(b)})),P.addEventListener("submit",(function(e){e.preventDefault();var t=P.querySelector(w.submitButtonSelector);T({buttonElement:t,isLoading:!0});var r,c,i={name:B.value,link:U.value};(r=i.name,c=i.link,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:r,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=e.owner._id;m.prepend(l(e,I,u,s,t)),n(b),P.reset(),f(P,w)})).catch((function(e){return console.log(e)})).finally((function(){T({buttonElement:t,isLoading:!1})}))})),g.addEventListener("click",(function(){return n(k)}));var D=document.querySelector(".popup_type_edit-avatar"),O=D.querySelector(".popup__form"),M=D.querySelector(".popup__input_type_url"),N=D.querySelector(".popup__close");document.querySelector(".profile__image").addEventListener("click",(function(){t(D),O.reset(),f(O,w)})),N.addEventListener("click",(function(){return n(D)})),O.addEventListener("submit",(function(e){e.preventDefault();var t,r=O.querySelector(w.submitButtonSelector);T({buttonElement:r,isLoading:!0}),(t=M.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){A.style.backgroundImage="url(".concat(e.avatar,")"),n(D)})).catch((function(e){return console.log(e)})).finally((function(){T({buttonElement:r,isLoading:!1})}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){var n="";e.validity.valueMissing?n="Вы пропустили это поле.":e.validity.tooShort?n="Должно быть от ".concat(e.minLength," до ").concat(e.maxLength," символов."):e.validity.patternMismatch?n=e.dataset.errorMessage||"Неверный формат.":e.validity.typeMismatch&&(n="url"===e.type?"Введите адрес сайта.":"Введите корректное значение."),e.validity.valid?d(e,t):function(e,t,n){var r=e.closest(n.formSelector).querySelector(".".concat(e.name,"-input-error"));r&&(r.textContent=t,r.classList.add(n.errorClass),e.classList.add(n.inputErrorClass))}(e,n,t)}(t,e),p(n,r,e)}))})),t.addEventListener("submit",(function(e){return e.preventDefault()})),p(n,r,e)}))}(w)})();